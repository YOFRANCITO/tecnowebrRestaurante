import{d as x,v,E as O,i as F,G as P,e as d,o as n,a as t,f as m,b as R,w as I,g as $,u as j,S as D,t as i,y as g,B as h,F as V,h as B,s as z,c as W,n as Z,H as q,C as J}from"./app-BOjp7WPP.js";import{C as N,r as K}from"./chart-DUfl3Dpl.js";import{_ as Q}from"./AppLayout-acO-gN44.js";import"./_plugin-vue_export-helper-DlAUqK2U.js";N.register(...K);const X={class:"flex items-center justify-between mb-6"},Y={key:0,class:"mb-4 p-4 rounded border shadow",style:{"background-color":"var(--success-bg)",color:"var(--success-text)","border-color":"var(--success-border)"}},ee={class:"overflow-x-auto shadow rounded-lg",style:{"background-color":"var(--bg-color)",color:"var(--text-color)"}},te={class:"mb-4"},se={class:"flex flex-col sm:flex-row items-center justify-between mb-4 gap-4"},ae={class:"flex gap-2 items-center"},oe={class:"min-w-full divide-y divide-gray-200"},re={class:"divide-y divide-gray-200"},le={class:"px-6 py-4",style:{color:"var(--text-color)"}},ne={class:"px-6 py-4",style:{color:"var(--text-color)"}},de={class:"px-6 py-4",style:{color:"var(--text-color)"}},ie={class:"px-6 py-4",style:{color:"var(--text-color)"}},ce={class:"px-6 py-4",style:{color:"var(--text-color)"}},ue={class:"px-6 py-4",style:{color:"var(--text-color)"}},pe={class:"px-6 py-4 text-right space-x-2"},xe=["onSubmit"],be={key:0,class:"text-center py-4",style:{color:"var(--text-muted)"}},fe={key:1,class:"mt-4 flex justify-center space-x-2"},he=Object.assign({layout:Q},{__name:"Index",props:{entradas:Object},setup(M){const w=x(null),c=M,_=v(()=>{var s;const a={};for(const e of c.entradas.data){const o=((s=e.gestion)==null?void 0:s.nombre)||"Sin gestión";a[o]=(a[o]||0)+1}return{labels:Object.keys(a),data:Object.values(a)}}),C=O().props.flash,k=v(()=>C.success||C.message),b=x(""),r=x(""),l=x(""),u=x([]);function T(){u.value=c.entradas.data.filter(a=>{const s=new Date(a.fecha),e=r.value?new Date(r.value):null,o=l.value?new Date(l.value):null;return!(e&&s<e||o&&s>o)})}function U(){r.value="",l.value="",u.value=c.entradas.data}F(()=>{u.value=c.entradas.data}),F(()=>{if(!w.value)return;const a=w.value.getContext("2d");new N(a,{type:"bar",data:{labels:_.value.labels,datasets:[{label:"Entradas por Gestión",data:_.value.data,backgroundColor:"rgba(59, 130, 246, 0.5)",borderColor:"rgba(59, 130, 246, 1)",borderWidth:1}]},options:{responsive:!0,maintainAspectRatio:!1,scales:{y:{beginAtZero:!0}}}})}),P(()=>c.entradas,a=>{u.value=a.data});const E=v(()=>{let a=u.value;const s=b.value.toLowerCase();return s?a.filter(e=>{var p,y,L,S;const o=((y=(p=e.user)==null?void 0:p.name)==null?void 0:y.toLowerCase())||"",f=((S=(L=e.tipoalerta)==null?void 0:L.descripcion)==null?void 0:S.toLowerCase())||"";return e.descripcion.toLowerCase().includes(s)||e.fecha.toLowerCase().includes(s)||e.hora.toLowerCase().includes(s)||o.includes(s)||f.includes(s)}):a});function A(a){confirm("¿Estás seguro de eliminar esta entrada?")&&J.delete(route("entrada.destroy",a),{preserveScroll:!0,preserveState:!1})}function G(){const a=new URLSearchParams;r.value&&a.append("inicio",r.value),l.value&&a.append("fin",l.value),window.open(route("entrada.export.excel")+"?"+a.toString(),"_blank")}const H=v(()=>!b.value&&!r.value&&!l.value);return(a,s)=>(n(),d("div",null,[t("div",X,[s[4]||(s[4]=t("h1",{class:"text-3xl font-bold",style:{color:"var(--text-color)"}},"Entradas",-1)),R(j(D),{href:a.route("entrada.create"),class:"bg-blue-600 hover:bg-blue-700 text-white font-semibold px-4 py-2 rounded shadow"},{default:I(()=>s[3]||(s[3]=[$(" + Nueva entrada ")])),_:1},8,["href"])]),k.value?(n(),d("div",Y,i(k.value),1)):m("",!0),t("div",ee,[t("div",te,[g(t("input",{"onUpdate:modelValue":s[0]||(s[0]=e=>b.value=e),type:"text",placeholder:"Buscar entrada...",class:"w-full sm:w-1/3 px-4 py-2 border border-gray-300 rounded shadow-sm focus:outline-none focus:ring focus:ring-blue-200"},null,512),[[h,b.value]])]),t("div",se,[t("div",ae,[g(t("input",{type:"date","onUpdate:modelValue":s[1]||(s[1]=e=>r.value=e),class:"border rounded px-3 py-2"},null,512),[[h,r.value]]),g(t("input",{type:"date","onUpdate:modelValue":s[2]||(s[2]=e=>l.value=e),class:"border rounded px-3 py-2"},null,512),[[h,l.value]]),t("button",{onClick:T,class:"bg-blue-600 hover:bg-blue-700 text-white font-semibold px-3 py-2 rounded shadow"}," Filtrar "),t("button",{onClick:U,class:"bg-gray-300 hover:bg-gray-400 text-gray-800 font-semibold px-3 py-2 rounded shadow"}," Limpiar ")]),t("div",{class:"flex gap-2"},[t("button",{onClick:G,class:"bg-green-600 hover:bg-green-700 text-white font-semibold px-4 py-2 rounded shadow"}," Exportar Excel ")])]),t("table",oe,[s[6]||(s[6]=t("thead",{style:{"background-color":"var(--bg-secondary)"}},[t("tr",null,[t("th",{class:"px-6 py-3 text-left text-sm font-semibold text-gray-700"},"Descripción"),t("th",{class:"px-6 py-3 text-left text-sm font-semibold text-gray-700"},"Fecha"),t("th",{class:"px-6 py-3 text-left text-sm font-semibold text-gray-700"},"Hora"),t("th",{class:"px-6 py-3 text-left text-sm font-semibold text-gray-700"},"Usuario"),t("th",{class:"px-6 py-3 text-left text-sm font-semibold text-gray-700"},"Gestión"),t("th",{class:"px-6 py-3 text-left text-sm font-semibold text-gray-700"},"Tipo de Alerta"),t("th",{class:"px-6 py-3 text-right text-sm font-semibold text-gray-700"},"Acciones")])],-1)),t("tbody",re,[(n(!0),d(V,null,B(E.value,e=>{var o,f,p;return n(),d("tr",{key:e.id},[t("td",le,i(e.descripcion),1),t("td",ne,i(e.fecha),1),t("td",de,i(e.hora),1),t("td",ie,i(((o=e.user)==null?void 0:o.name)||"—"),1),t("td",ce,i(((f=e.gestion)==null?void 0:f.nombre)||"—"),1),t("td",ue,i(((p=e.tipoalerta)==null?void 0:p.descripcion)||"—"),1),t("td",pe,[t("form",{onSubmit:z(y=>A(e.id),["prevent"]),class:"inline"},s[5]||(s[5]=[t("button",{type:"submit",class:"bg-red-500 hover:bg-red-600 text-white px-3 py-1 rounded shadow"}," Eliminar ",-1)]),40,xe)])])}),128))])]),E.value.length===0?(n(),d("div",be," No se encontraron entradas. ")):m("",!0),H.value?(n(),d("div",fe,[(n(!0),d(V,null,B(c.entradas.links,e=>(n(),W(q(e.url?j(D):"span"),{key:e.label,href:e.url,class:Z(["px-3 py-1 rounded border text-sm",{"bg-blue-600 text-white font-semibold":e.active,"bg-white text-gray-700 hover:bg-gray-100":!e.active,"cursor-not-allowed opacity-50":!e.url}]),innerHTML:e.label},null,8,["href","class","innerHTML"]))),128))])):m("",!0)])]))}});export{he as default};
